# Chapter 1 최신 웹을 위한 도큐먼트 데이터베이스

- 웹 애플리케이션을 개발한 적이 있다면 관계 데이터 베이스(RDBMS) 를 사용했을 것.

- 비관계 데이터베이스(nonrelational database) 로 옮기면 어떤 장점이 있을까? 개발자들이 왜 MongoDB 에 관심을 갖는가?

- 개발자들이 MongoDB 를 사용하는 이유는 아마도 확장성 때문이 아니라 직관적인 데이터 모델 때문일 것. 행(row) 대신에 도큐먼트(document) 에 저장한ㄷ.

```javascript
{
    _id: 10,
    username: 'peter',
    email: 'pbbakkum@gmail.com'
}
```

> 매우 단순한 도큐먼트

- 사용자에 대한 정보를 몇 개의 필드로 저장했다. 이와 같은 모델의 장점은 각각의 사용자에 대해 여러 개의 이메일 주소를 저장하는 경우를 생각해 보자. 관계 모델에서는 서로 조인(Join) 을 하기 위해 이메일 주소와 사용자 테이블을 각각 만들어야 한다.

- MongoDB 는 이러한 정보를 저장하기 위한 또 다른 방법을 제공한다.

```javascript
{
    _id: 10,
    username: 'peter',
    email: ['pbbakkum@gmail.com',
            'whrbql1@gmail.com'
           ]
}
```

- 위와 같은 방법으로 이메일 주소를 배열로 만들어 문제를 해결할 수 있다. 개발자로서 데이터의 변경이 발생했을 때 테이블을 추가하거나 스키마(schema) 를 맞춰야 하는 걱정 없이 구조화된 도큐먼트를 데이터베이스에 저장할 수 있다는 것에 매우 유용함을 느낄 수 있다.

- MongoDB 의 도큐먼트 형식은 JSON 에 기반, 키와 값 으로 이루어져 있고, 중첩에 제한이 없다.

- 도큐먼트 기반의 데이터 모델은 풍부하고 계층적인 구조의 데이터를 표현할 수 있다. 따라서, RDBMS 에서 필요한 테이블 간의 복잡한 조인 연산이 없어도 된다.

---

## 1.2 MongoDB 의 핵심 기능

### 1.2.1 도큐먼트 데이터 모델

- MongoDB 는 도큐먼트 지향적인 데이터베이스이다.

```javascript
{
    _id: ObjectID('4bd9e8e17cefd644108961bb'),
    title: 'Adventures in Databases',
    url: 'http://example.com/databases.txt',
    author: 'msmith',
    vote_count: 20,
    tags; ['databases', 'mongodb', 'indexing'],
    image: {
        url: 'http://example/com/db.jpg',
        caption: 'A databse.',
        type: 'jpg',
        size: 75831,
        data: 'Binary'
    },
    comments: [
        {
            user: 'bjones',
            text: 'Interstring article.'
        },
        {
            user: 'sverch',
            text: 'Color me skeptical!'
        }
    ]

}
```

- 위에서 볼 수 있듯이 도큐먼트(document) 는 본질적으로 속성의 이름과 값이다. 속성의 값은 문자열, 숫자, 날짜와 같이 간단한 데이터 타입 뿐만 아니라 배열이나 심지어 다른 JSON 도큐먼트가 될 수 있다.

- MongoDB 는 Binary JSON 혹은 BSON 의 형태로 도큐먼트를 저장한다. **MySQL은 데이터를 테이블에 행으로 저장하는 반면, MongoDB 는 도큐먼트의 모음을 컬렉션(colletion) 에 저장한다.** 컬렉션에 있는 데이터는 디스크로 저장되므로 찾고자 하는 컬렉션이 무엇인지 쿼리에서 명시해야 찾을 수 있다.

- 도큐먼트 지향적인 데이터 모델에서는 객체를 자연스럽게 모아 놓은 형태로 표현함으로 객체를 전체적으로 작업할 수 있다는 점이다. 관계형 데이터베이스에서는 이를 위해 정규화를 해야하지만 이런 점이 덜하다는 것이 장점

- **구조가 다양하다는 점 외에도 도큐먼트에는 미리 정해진 스키마가 없다.**

- MongoDB 에서는 도큐먼트를 컬렉션으로 모아 놓는데, 어떤 종류의 스키마도 필요하지 않다. 이론적으로는 하나의 컬렉션에 포함되어 있는 각각의 도큐먼트들이 서로 완전히 다른 구조를 갖는 것도 가능하지만, 실제로는 컬렉션 내에서 도큐먼트들은 상대적으로 균일할 구조를 갖는다.

- 이렇게 스키마가 없는 모델이므로

  - 데이터베이스가 아닌 애플리케이션이 데이터 구조를 정한다. 데이터의 구조가 빈번히 변경되는 개발 초기 단계에서 개발 속도를 단축시켜 준다.

  - 스키마가 없는 데이터 모델을 통해 가변적인 속성을 갖는 데이터를 표현할 수 있다.

  - 도큐먼트로 데이터를 모델링하면 조인(JOIN)이 필요 없어, 새로운 속성은 한 도큐먼트에 동적으로 추가할 수 있다.

---

### 1.2.2 애드혹 쿼리

- 일반적인 NoSQL 데이터베이스에서는 확장성이 높은 모델을 채용하고 있으므로 동적 질의를 제공하지 않는데, MongoDB 는 설계 목적중 하나로 RDBMS 의 필수적인 쿼리 기능을 NoSQL 에서도 사용할 수 있게 하는 것이다.

- 필드, 범위쿼리, 정규식 검색, 자바스크립트 함수를 지원 한다는 말이다.

---

### 1.2.3 인덱스

- 많은 도큐먼트를 데이터베이스에 더할 수록 값을 찾는 비용 역시 점점 증가하게 되는데, 이는 확장하는 건초 더미 속에 있는 바늘과 같은 것이다. 효과적으로 데이터를 검색할 수 있는 바업이 필요한데, 이것이 인덱스이다.

- 키워드와 페이지 번호를 연결해 놓은 요리책을 상상해 보자.

- MongoDB 에서 인덱스는 B-트리(B-tree) 로 구현되어 있다.

- 스토리지 엔진으로 WiredTiger 를 사용한다. (검색해도 잘 모름)

- MongoDB 역시, 각 도큐먼트 의 고유의 식별자로서 Primary Key 를 부여 한다. 자동으로 인덱스되어 각 기준은 유니크 키를 이용하여 효과적으로 기억되며, MongoDB 역시 이와 다르지 않다.

- MongoDB 한 컬렉션에 64개까지 세컨더리 인덱스를 만들 수 있다.

---

### 1.2.4 복제

- MongoDB 는 복제 세트(replica set) 이라고 부르는 구성을 통해 데이터베이스 복제(replication) 기능을 제공한다. 복제 세트는 서버와 네트워크 장애가 발생할 경우를 대비해 중복성과 장애조치 자동화를 위해 데이터를 여러 대의 서버에 분산한다. 복제는 데이터베이스 읽기에 대한 확장을 위해서도 사용된다. 웹에서와 같은 읽기 위주의 애플리케이션에서는 데이터베이스 읽기를 복제 세트 클러스터 내의 여러 서버에 분산할 수 있다.

- 복제 세트는 많은 Mongo DB 서버로 구성되어 있는데, 보통 각각의 MongoDB 서버는 분리된 물리 장베 별도로 존재하며, 이를 노드(node) 라고 부른다. 어느 순간이든지 하나의 노드는 복제 세트의 프라이머리 노드(primary node)로 존재하며, 더불어 하나 또는 그 이상의 세컨더리 노드가 존재한다.

- 다른 데이터베이스에서 제공하므로 익숙할 수도 있는 마스터-슬레이브 복제에서와 같이 복제 세트의 프라이머리 노드에 대해서는 읽기와 쓰기가 모두 가능하지만, 세컨더리 노드는 읽기만 가능하다. 복제 세트의 고유한 기능은 자동 장애조치를 지원한다는 점이다. 만일 프라이머리 노드에 장애가 발생하면 클러스터는 자동으로 세컨더리 가운데 하나를 선택해서 프라이머리를 설정한다. 이전의 프라이머리 노드가 복구되면 세컨더리 노드로 작동한다.

- 8장에서 자세하게 다룬다.
- ![다운로드](https://user-images.githubusercontent.com/50399804/114273897-fd272c80-9a56-11eb-855b-97ecfd1939bb.png)
